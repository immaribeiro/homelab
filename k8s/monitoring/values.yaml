# kube-prometheus-stack values
# Focus: lightweight homelab metrics + Grafana via Cloudflare Tunnel

fullnameOverride: monitoring

alertmanager:
  enabled: true
  alertmanagerSpec:
    replicas: 1
    storage:
      volumeClaimTemplate:
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 5Gi

prometheus:
  prometheusSpec:
    replicas: 1
    retention: 15d
    scrapeInterval: 30s
    evaluationInterval: 30s
    storageSpec:
      volumeClaimTemplate:
        spec:
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: 50Gi
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi

kubeStateMetrics:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi

nodeExporter:
  resources:
    requests:
      cpu: 30m
      memory: 64Mi

# Thanos sidecar disabled for simplicity
thanosRuler:
  enabled: false

grafana:
  enabled: true
  # Set known admin credentials (stored in auto-generated secret)
  adminUser: admin
  adminPassword: admin
  # Security context to fix permission issues with persistent storage
  securityContext:
    runAsNonRoot: true
    runAsUser: 472
    runAsGroup: 472
    fsGroup: 472
  initChownData:
    enabled: false
  service:
    type: ClusterIP
    port: 80
  grafana.ini:
    server:
      root_url: https://grafana.immas.org
      serve_from_sub_path: false
  defaultDashboardsTimezone: browser
  defaultDashboardsEnabled: true
  plugins:
    - grafana-piechart-panel
  sidecar:
    dashboards:
      enabled: true
      label: grafana_dashboard
      labelValue: "1"
      searchNamespace: ALL
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistence:
    enabled: true
    type: pvc
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  ingress:
    enabled: false
